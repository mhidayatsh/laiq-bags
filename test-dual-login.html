<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dual Login Test - Laiq Bags</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .session-info {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        .admin-session { border-left-color: #28a745; }
        .customer-session { border-left-color: #ffc107; }
        .warning { border-left-color: #dc3545; background: #fff5f5; }
        .button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }
        .button.admin { background: #28a745; }
        .button.customer { background: #ffc107; color: #333; }
        .button.danger { background: #dc3545; }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.warning { background: #fff3cd; color: #856404; }
        .status.error { background: #f8d7da; color: #721c24; }
        .instructions {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Dual Login Test - Laiq Bags</h1>
        
        <div class="instructions">
            <h3>üìã How to Test Dual Login:</h3>
            <ol>
                <li><strong>Open this page in Tab A</strong> - This will be your "Customer Tab"</li>
                <li><strong>Open this page in Tab B</strong> - This will be your "Admin Tab"</li>
                <li><strong>Login as Customer in Tab A</strong> using the customer login form</li>
                <li><strong>Login as Admin in Tab B</strong> using the admin login form</li>
                <li><strong>Observe both sessions</strong> running simultaneously</li>
            </ol>
        </div>

        <div class="session-info admin-session">
            <h3>üîë Admin Session Status</h3>
            <div id="admin-status">Not logged in</div>
            <div id="admin-details"></div>
        </div>

        <div class="session-info customer-session">
            <h3>üë§ Customer Session Status</h3>
            <div id="customer-status">Not logged in</div>
            <div id="customer-details"></div>
        </div>

        <div class="session-info warning">
            <h3>‚ö†Ô∏è Session Conflicts</h3>
            <div id="conflict-status">No conflicts detected</div>
        </div>

        <div class="session-info">
            <h3>üéØ Test Actions</h3>
            
            <h4>Admin Actions:</h4>
            <button class="button admin" onclick="simulateAdminLogin()">Simulate Admin Login</button>
            <button class="button admin" onclick="simulateAdminLogout()">Simulate Admin Logout</button>
            
            <h4>Customer Actions:</h4>
            <button class="button customer" onclick="simulateCustomerLogin()">Simulate Customer Login</button>
            <button class="button customer" onclick="simulateCustomerLogout()">Simulate Customer Logout</button>
            
            <h4>Session Management:</h4>
            <button class="button" onclick="clearAllSessions()">Clear All Sessions</button>
            <button class="button" onclick="refreshStatus()">Refresh Status</button>
        </div>

        <div class="session-info">
            <h3>üìä Current localStorage State</h3>
            <div id="localStorage-state"></div>
        </div>

        <div class="session-info">
            <h3>üîó Test Admin Pages</h3>
            <p>Test these pages to see how the session cleanup works:</p>
            <a href="/enhanced-order-management.html" class="button admin" target="_blank">Enhanced Order Management</a>
            <a href="/billing-management.html" class="button admin" target="_blank">Billing Management</a>
            <a href="/shipping-management.html" class="button admin" target="_blank">Shipping Management</a>
            <a href="/admin.html" class="button admin" target="_blank">Main Admin Panel</a>
        </div>
    </div>

    <script>
        // Simulate admin login
        function simulateAdminLogin() {
            const adminUser = {
                id: 'admin123',
                name: 'Admin User',
                email: 'admin@laiq.shop',
                role: 'admin',
                loginTime: new Date().toISOString()
            };
            
            localStorage.setItem('token', 'admin-token-' + Date.now());
            localStorage.setItem('user', JSON.stringify(adminUser));
            
            showStatus('Admin login successful!', 'success');
            refreshStatus();
        }

        // Simulate customer login
        function simulateCustomerLogin() {
            const customerUser = {
                id: 'customer123',
                name: 'Customer User',
                email: 'customer@laiq.shop',
                role: 'user',
                loginTime: new Date().toISOString()
            };
            
            localStorage.setItem('customerToken', 'customer-token-' + Date.now());
            localStorage.setItem('customerUser', JSON.stringify(customerUser));
            
            showStatus('Customer login successful!', 'success');
            refreshStatus();
        }

        // Simulate admin logout
        function simulateAdminLogout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            showStatus('Admin logout successful!', 'success');
            refreshStatus();
        }

        // Simulate customer logout
        function simulateCustomerLogout() {
            localStorage.removeItem('customerToken');
            localStorage.removeItem('customerUser');
            showStatus('Customer logout successful!', 'success');
            refreshStatus();
        }

        // Clear all sessions
        function clearAllSessions() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            localStorage.removeItem('customerToken');
            localStorage.removeItem('customerUser');
            showStatus('All sessions cleared!', 'success');
            refreshStatus();
        }

        // Show status message
        function showStatus(message, type = 'info') {
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            document.body.insertBefore(statusDiv, document.body.firstChild);
            
            setTimeout(() => {
                statusDiv.remove();
            }, 3000);
        }

        // Refresh status display
        function refreshStatus() {
            const adminToken = localStorage.getItem('token');
            const adminUser = localStorage.getItem('user');
            const customerToken = localStorage.getItem('customerToken');
            const customerUser = localStorage.getItem('customerUser');

            // Update admin status
            if (adminToken && adminUser) {
                try {
                    const userData = JSON.parse(adminUser);
                    document.getElementById('admin-status').innerHTML = 
                        `<span class="status success">‚úÖ Logged in as ${userData.name} (${userData.role})</span>`;
                    document.getElementById('admin-details').innerHTML = 
                        `<small>Email: ${userData.email}<br>Login: ${new Date(userData.loginTime).toLocaleString()}</small>`;
                } catch (error) {
                    document.getElementById('admin-status').innerHTML = 
                        '<span class="status error">‚ùå Invalid admin session data</span>';
                    document.getElementById('admin-details').innerHTML = '';
                }
            } else {
                document.getElementById('admin-status').innerHTML = 
                    '<span class="status warning">‚ùå Not logged in</span>';
                document.getElementById('admin-details').innerHTML = '';
            }

            // Update customer status
            if (customerToken && customerUser) {
                try {
                    const userData = JSON.parse(customerUser);
                    document.getElementById('customer-status').innerHTML = 
                        `<span class="status success">‚úÖ Logged in as ${userData.name} (${userData.role})</span>`;
                    document.getElementById('customer-details').innerHTML = 
                        `<small>Email: ${userData.email}<br>Login: ${new Date(userData.loginTime).toLocaleString()}</small>`;
                } catch (error) {
                    document.getElementById('customer-status').innerHTML = 
                        '<span class="status error">‚ùå Invalid customer session data</span>';
                    document.getElementById('customer-details').innerHTML = '';
                }
            } else {
                document.getElementById('customer-status').innerHTML = 
                    '<span class="status warning">‚ùå Not logged in</span>';
                document.getElementById('customer-details').innerHTML = '';
            }

            // Check for conflicts
            if (adminToken && adminUser && customerToken && customerUser) {
                try {
                    const adminData = JSON.parse(adminUser);
                    const customerData = JSON.parse(customerUser);
                    
                    if (adminData.role === 'admin' && customerData.role === 'user') {
                        document.getElementById('conflict-status').innerHTML = 
                            '<span class="status warning">‚ö†Ô∏è Both sessions active - Admin and Customer</span>';
                    } else if (adminData.role === 'admin' && customerData.role === 'admin') {
                        document.getElementById('conflict-status').innerHTML = 
                            '<span class="status warning">‚ö†Ô∏è Both sessions have admin role - Potential conflict</span>';
                    } else {
                        document.getElementById('conflict-status').innerHTML = 
                            '<span class="status warning">‚ö†Ô∏è Both sessions active with mixed roles</span>';
                    }
                } catch (error) {
                    document.getElementById('conflict-status').innerHTML = 
                        '<span class="status error">‚ùå Error parsing session data</span>';
                }
            } else {
                document.getElementById('conflict-status').innerHTML = 
                    '<span class="status success">‚úÖ No conflicts detected</span>';
            }

            // Show localStorage state
            const state = {
                token: adminToken ? 'Set' : 'Not set',
                user: adminUser ? 'Set' : 'Not set',
                customerToken: customerToken ? 'Set' : 'Not set',
                customerUser: customerUser ? 'Set' : 'Not set'
            };
            
            document.getElementById('localStorage-state').innerHTML = 
                `<div class="code">${JSON.stringify(state, null, 2)}</div>`;
        }

        // Auto-refresh status every 2 seconds
        setInterval(refreshStatus, 2000);

        // Initial status check
        refreshStatus();
    </script>
</body>
</html>
