const mongoose = require('mongoose');
require('dotenv').config({ path: './config.env' });

// Import Product model
const Product = require('../models/Product');

// Connect to MongoDB
mongoose.connect(process.env.MONGODB_URI, {
    useNewUrlParser: true,
    useUnifiedTopology: true,
}).then(() => {
    console.log('‚úÖ Connected to MongoDB');
}).catch((err) => {
    console.error('‚ùå MongoDB connection error:', err);
    process.exit(1);
});

// Test product data (simulating admin panel input)
const testProduct = {
    name: "Premium Leather Backpack",
    description: "High-quality genuine leather backpack perfect for work and travel. Features multiple compartments, laptop sleeve, and water-resistant design. Made from premium materials for durability and style.",
    price: 2500,
    category: "backpack",
    type: "backpack",
    size: "Medium",
    material: "Genuine Leather",
    colors: ["Brown", "Black"],
    images: [{
        public_id: "test-image-1",
        url: "https://example.com/backpack-1.jpg",
        alt: "Premium Leather Backpack",
        isPrimary: true
    }],
    colorVariants: [{
        name: "Brown",
        code: "#8B4513",
        stock: 10,
        isAvailable: true
    }, {
        name: "Black", 
        code: "#000000",
        stock: 15,
        isAvailable: true
    }],
    stock: 25,
    featured: true,
    bestSeller: false,
    newArrival: true,
    createdBy: "507f1f77bcf86cd799439011" // Test user ID
};

// Demonstrate SEO generation process
async function demonstrateSEOProcess() {
    try {
        console.log('üîÑ Demonstrating SEO generation for new product...\n');
        
        console.log('üìù STEP 1: Original Product Data (Admin Input)');
        console.log('=' .repeat(50));
        console.log('Name:', testProduct.name);
        console.log('Description:', testProduct.description.substring(0, 100) + '...');
        console.log('Category:', testProduct.category);
        console.log('Material:', testProduct.material);
        console.log('Price: ‚Çπ', testProduct.price);
        console.log('Colors:', testProduct.colors.join(', '));
        console.log('');
        
        // Create product (this triggers SEO generation)
        console.log('ü§ñ STEP 2: Creating Product (Triggers SEO Generation)');
        console.log('=' .repeat(50));
        
        const product = new Product(testProduct);
        await product.save();
        
        console.log('‚úÖ Product created successfully!');
        console.log('üÜî Product ID:', product._id);
        console.log('');
        
        // Show generated SEO fields
        console.log('üéØ STEP 3: Auto-Generated SEO Fields');
        console.log('=' .repeat(50));
        console.log('üîó Slug:', product.slug);
        console.log('üìù SEO Title:', product.seoTitle);
        console.log('üìÑ Meta Description:', product.metaDescription);
        console.log('üè∑Ô∏è SEO Keywords:', product.seoKeywords.join(', '));
        console.log('');
        
        // Show what happens on frontend
        console.log('üåê STEP 4: Frontend SEO Tags (Generated by JavaScript)');
        console.log('=' .repeat(50));
        console.log('üìÑ Page Title:', `${product.seoTitle} - Laiq Bags`);
        console.log('üìù Meta Description:', product.metaDescription);
        console.log('üîó Canonical URL:', `https://laiqbags.com/product.html?id=${product._id}`);
        console.log('');
        
        // Show structured data
        console.log('üìä STEP 5: Structured Data (JSON-LD)');
        console.log('=' .repeat(50));
        const structuredData = {
            "@context": "https://schema.org",
            "@type": "Product",
            "name": product.name,
            "description": product.description,
            "brand": {
                "@type": "Brand",
                "name": "LAIQ"
            },
            "category": product.category,
            "image": product.images.map(img => img.url),
            "offers": {
                "@type": "Offer",
                "price": product.price,
                "priceCurrency": "INR",
                "availability": product.stock > 0 ? "https://schema.org/InStock" : "https://schema.org/OutOfStock",
                "seller": {
                    "@type": "Organization",
                    "name": "Laiq Bags"
                },
                "shippingDetails": {
                    "@type": "OfferShippingDetails",
                    "shippingRate": {
                        "@type": "MonetaryAmount",
                        "value": "0",
                        "currency": "INR"
                    },
                    "deliveryTime": {
                        "@type": "ShippingDeliveryTime",
                        "handlingTime": {
                            "@type": "QuantitativeValue",
                            "minValue": 1,
                            "maxValue": 2,
                            "unitCode": "DAY"
                        },
                        "transitTime": {
                            "@type": "QuantitativeValue",
                            "minValue": 3,
                            "maxValue": 7,
                            "unitCode": "DAY"
                        }
                    }
                },
                "hasMerchantReturnPolicy": {
                    "@type": "MerchantReturnPolicy",
                    "applicableCountry": "IN",
                    "returnPolicyCategory": "https://schema.org/MerchantReturnFiniteReturnWindow",
                    "merchantReturnDays": 30,
                    "returnMethod": "https://schema.org/ReturnByMail",
                    "returnFees": "https://schema.org/FreeReturn"
                }
            }
        };
        console.log(JSON.stringify(structuredData, null, 2));
        console.log('');
        
        // Show social media tags
        console.log('üì± STEP 6: Social Media Tags');
        console.log('=' .repeat(50));
        console.log('üìò Facebook (Open Graph):');
        console.log(`  og:title = "${product.seoTitle}"`);
        console.log(`  og:description = "${product.metaDescription}"`);
        console.log(`  og:type = "product"`);
        console.log(`  og:url = "https://laiqbags.com/product.html?id=${product._id}"`);
        console.log(`  og:image = "${product.images[0]?.url}"`);
        console.log('');
        console.log('üê¶ Twitter Card:');
        console.log(`  twitter:card = "product"`);
        console.log(`  twitter:title = "${product.seoTitle}"`);
        console.log(`  twitter:description = "${product.metaDescription}"`);
        console.log(`  twitter:image = "${product.images[0]?.url}"`);
        console.log('');
        
        // Show sitemap entry
        console.log('üó∫Ô∏è STEP 7: Sitemap Entry');
        console.log('=' .repeat(50));
        console.log('<url>');
        console.log(`  <loc>https://laiqbags.com/product.html?id=${product._id}</loc>`);
        console.log(`  <lastmod>${new Date().toISOString().split('T')[0]}</lastmod>`);
        console.log('  <changefreq>weekly</changefreq>');
        console.log('  <priority>0.8</priority>');
        console.log('</url>');
        console.log('');
        
        // Show SEO benefits
        console.log('üéØ STEP 8: SEO Benefits');
        console.log('=' .repeat(50));
        console.log('‚úÖ Google: Rich snippets with price, availability');
        console.log('‚úÖ Facebook: Rich preview with image and description');
        console.log('‚úÖ Twitter: Product card with details');
        console.log('‚úÖ WhatsApp: Rich link preview');
        console.log('‚úÖ Search Rankings: Better visibility');
        console.log('‚úÖ User Experience: Clear titles and descriptions');
        console.log('');
        
        console.log('üéâ RESULT: Complete SEO optimization achieved automatically!');
        console.log('üìà Your product is now ready for search engines and social media!');
        
        // Clean up - delete test product
        await Product.findByIdAndDelete(product._id);
        console.log('\nüßπ Test product cleaned up');
        
    } catch (error) {
        console.error('‚ùå Error in SEO demonstration:', error);
    }
}

// Run the demonstration
demonstrateSEOProcess()
    .then(() => {
        console.log('\n‚úÖ SEO demonstration completed');
        process.exit(0);
    })
    .catch((error) => {
        console.error('‚ùå SEO demonstration failed:', error);
        process.exit(1);
    });
